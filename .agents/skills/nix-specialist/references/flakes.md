# Nix Flakes

## 1. 目的

`flake.nix` と `flake.lock` を中心に、再現可能なプロジェクト構成を設計・運用するための参照。

## 2. 要点

- `inputs` で依存を定義し、`outputs` で成果物を公開する。
- `flake.lock` で依存の解決結果を固定する。
- `nix develop` で開発シェルを統一できる。
- `nix run` / `nix build` / `nix flake check` を目的別に使う。
- 複数プラットフォーム対応ではシステム別出力を整理する。
- 密閉性（hermeticity）を意識し、外部環境依存を抑える。

## 3. 実務運用の型

1. `inputs` を最小から開始し、必要な依存だけ追加する。
2. `outputs` を `packages` / `devShells` / `checks` で分ける。
3. 更新時は `flake.lock` の差分を確認する。
4. CIやローカルで `nix flake check` を常用する。

## 4. 誤りやすい点

- Git未追跡ファイルを参照し、評価時に見えない問題を起こす。
- `inputs` を増やしすぎて責務不明な構成になる。
- ロック更新を無計画に行い、変更影響を追えなくなる。

## 5. ベストプラクティス

- リポジトリに必要ファイルを明示的に含める。
- `outputs` の責務を文書化し、命名規約を揃える。
- ロック更新は小さく、差分レビュー可能な単位で行う。
- 失敗時は評価段階とビルド段階を分離して切り分ける。

## 6. 主要参照

- Nix Manual (Flakes章)
- Zenn: `nix-hands-on`
