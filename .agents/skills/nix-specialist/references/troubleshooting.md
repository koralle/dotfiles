# トラブルシュート

## 1. 目的

Nix関連の失敗を「評価エラー」と「ビルドエラー」に分け、最短で原因を特定するための参照。

## 2. 切り分けの基本

1. 評価段階で失敗しているか確認する。
2. ビルド段階で失敗しているか確認する。
3. 依存解決、入力ファイル、対象システムを順に確認する。

## 3. よく使う確認手段

- `--show-trace`:
  評価エラーの詳細スタックを確認する。
- `nix flake check`:
  Flake定義の整合性を総合確認する。
- `nix repl`:
  式の部分評価と値確認を行う。
- `builtins.trace`:
  評価時の一時的な観測点を入れる。

## 4. 典型パターン

- 評価エラー:
  属性名誤り、型不一致、未追跡ファイル参照、入力不足。
- ビルドエラー:
  依存不足、プラットフォーム不一致、外部ツール前提の崩れ。

## 5. 誤りやすい点

- エラー分類をせずに対策を試し続ける。
- 直近変更以外まで同時に変更して再現性を失う。
- 一時デバッグコードを残したまま運用する。

## 6. ベストプラクティス

- 変更を1つずつ戻し、最小再現ケースを作る。
- 失敗ログと使用コマンドをセットで記録する。
- 修正後に同じ確認手順で回帰チェックする。
